!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("PDFViewCtrl"),require("hammerjs")):"function"==typeof define&&define.amd?define(["PDFViewCtrl","hammerjs"],t):"object"==typeof exports?exports.PDFViewCtrl_EditGraphicsAddonModule=t(require("PDFViewCtrl"),require("hammerjs")):e.PDFViewCtrl_EditGraphicsAddonModule=t(e.PDFViewCtrl,e.Hammer)}(self,function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=21)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),o=n(18);var i=r.Deps.jQuery,a=r.shared.browser.ptPxRatio,c=r.Events,u=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.graphicsObject=t,this.pageRender=n,this.dependences=r}return e.prototype.active=function(){var e=this.$handler;if(!e){e=this.initUI(),this.$handler=e;var t=this.getContextMenuConfig();t&&e.contextMenu(this.translateContextMenuName(t))}var n=this.dependences.pdfViewer.getStateHandlerManager().getCurrentStates();n.activedChildrenCount?n.activedChildrenCount++:n.activedChildrenCount=1,this.dependences.pdfViewer.setActiveElement(this),this.isActive=!0,e.addClass("fwr__active"),this.updateShapeControl(),this.bindEvent()},e.prototype.getContextMenuConfig=function(){throw new Error("Not implemented!")},e.prototype.removeGraphicObject=function(){this.remove()},e.prototype.bindEvent=function(){var e=this;this.__off__delete__event__&&this.__off__delete__event__(),this.__off__delete__event__=this.dependences.pdfViewer.getKeyboardEventBinder(o.VIEWER_BINDER).on(o.KEY_MAP_DELETE_ANNOTATION,function(t){e.removeGraphicObject(),t.stopPropagation()}),this.__off__esc__event__&&this.__off__esc__event__(),this.__off__esc__event__=this.dependences.pdfViewer.getKeyboardEventBinder(o.ANNOTATION_CREATING_BINDER).on(o.KEY_MAP_ESC_CREATING_DRAWING,function(t){e.unActive(!0)})},e.prototype.unBindEvent=function(){this.__off__delete__event__&&this.__off__delete__event__(),this.__off__delete__event__=function(){},this.__off__esc__event__&&this.__off__esc__event__(),this.__off__esc__event__=function(){}},e.prototype.translateContextMenuName=function(e){for(var t in e)switch(t){case"items":var n=e[t],r=this.dependences.pdfViewer.i18n;for(var o in n){var i=n[o];i.nameI18nKey&&(i.name=r.t(i.nameI18nKey))}}return e},e.prototype.updateShapeControl=function(){var e=this.getBoundary(),t=this._getShapeControllerBoundaryBox();this.shapeControl&&this.shapeControl.active(this.$handler,e,t)},e.prototype.unActive=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$handler&&(this.isActive&&(this.isActive=!1,this.$handler.removeClass("fwr__active"),this.shapeControl&&this.shapeControl.deactive(),this.destroy(),this.unBindEvent(),!1===e&&this.dependences.pdfViewer.getStateHandlerManager().getCurrentStates().activedChildrenCount--))},e.prototype.destroy=function(){this.dependences.pdfViewer.eventEmitter.off(c.zoomToSuccess,this.afterZoom),this.$handler&&this.$handler.remove(),this.$handler=null},e.prototype.getModel=function(){return this.graphicsObject},e.prototype._getShapeControllerBoundaryBox=function(){var e=this.pageRender.page,t=a*this.pageRender.getScale(),n=e.getPxWidth()*t,r=e.getPxHeight()*t;if(this.pageRender.rotate%180!=0){var o=[n,r];r=o[0],n=o[1]}return{left:0,top:0,width:n,height:r}},e.prototype.getBoundary=function(){var e=this.pageRender.page,t=this.graphicsObject.getRect(),n=e.getDeviceRect(t,this.pageRender.getScale(),0);return{left:n.left,top:n.top,width:n.right-n.left,height:n.bottom-n.top}},e.prototype.initUI=function(){var e=this,t=this.$handler=i('<div class="fwr__graphics-object-handler"\n        ></div>');this.pageRender.pageHandler.$handler.append(t),this.shapeControl=new r.ShapeControl({start:function(t,n,r){return e.onStartUpdateShape(t,n,r)},moving:function(t,n,r){var o=r.offsetX,i=r.offsetY;return e.onShapeMoving(t,n,o,i)},update:function(t,n){return e.onShapeUpdating(t,n)},end:function(t,n,r){return e.onShapeUpdateEnd(t,n,r)},resizable:!0,enableDiagonally:!0,enableFrame:!0,previewer:!0});var n=this;return this.dependences.pdfViewer.eventEmitter.on(c.zoomToSuccess,this.afterZoom=function(){n.updateShapeControl()}),this.$handler},e.prototype.onStartUpdateShape=function(e,t,n){var r=this;"move"&&(i(this.shapeControl.ui.querySelector(".fv__shape-control-previewer")).show(),this.graphicsObject.getBitmap(this.pageRender.getScale()).then(function(e){if(e){var t=r.shapeControl.getPreviewerContext();i(t.canvas).attr({width:e.width,height:e.height});var n=t.createImageData(e.width,e.height+1),o=new(Uint8ClampedArray||Uint8Array)(e.buffer);n.data.set(o),t.putImageData(n,0,0)}}))},e.prototype.onShapeMoving=function(e,t){},e.prototype.onShapeUpdating=function(e,t){},e.prototype.onShapeUpdateEnd=function(e,t,n){var r=this,o=Object.assign({},e);o.right=o.left+o.width,o.bottom=o.top+o.height,o=this.pageRender.page.reverseDeviceRect(o,this.pageRender.getScale()),this.graphicsObject.setMatrix(o).then(function(e){i(r.shapeControl.ui.querySelector(".fv__shape-control-previewer")).hide(),r.updateShapeControl()})},e.prototype.setColor=function(e){return this.graphicsObject.setBorderColor(e)},e.prototype.setBorderStyle=function(e,t){var n=this;return this.graphicsObject.setBorderStyle(e,t).then(function(e){n.updateShapeControl()})},e.prototype.setOpacity=function(e){return this.graphicsObject.setOpacity(e)},e.prototype.setFillColor=function(e){return this.graphicsObject.setFillColor(e)},e.prototype.setBorderWidth=function(e){var t=this;return this.graphicsObject.setBorderWidth(e).then(function(e){t.updateShapeControl()})},e}();t.default=u},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getClientX=function(e){if("clientX"in e)return e.clientX;switch(e.type){case"touchstart":case"touchmove":return e.touches[0].clientX;case"touchend":case"touchcancel":return e.changedTouches[0].clientX}},t.getClientY=function(e){if("clientY"in e)return e.clientY;switch(e.type){case"touchstart":case"touchmove":return e.touches[0].clientY;case"touchend":case"touchcancel":return e.changedTouches[0].clientY}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={textObjectActive:"text-object-active",textObjectUnActive:"text-object-unactive",addTextObjectParamTransfer:"add-text-object-param-transfer"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.default=function(e){var t=e.graphicsManager;return function(n){function o(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,n.call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}}(e,t))}(o,n),o.getStateName=function(){return"add-text-object"},o.prototype.pageHandler=function(n){var o=this;this.pageRender=n;var c=n.getPDFPage(),s=n.$handler,f=s[0];s.addClass(u);var l=this.hammer=new i.default(f);l.on("tap",function(i){o.resetHandler();var a=i.changedPointers[0];c.then(function(e){return[e,e.reverseDevicePoint([a.offsetX,a.offsetY],n.getScale())]}).then(function(e){var t=r(e,2),n=t[0],i=r(t[1],2),a=i[0],c=i[1];return n.addGraphicsObject(Object.assign({},o.addParams,{originPosition:{x:a,y:c}},{type:1}))}).then(function(e){return e?[t.get(e),e]:Promise.reject()}).then(function(t){var o=r(t,2),i=o[0],a=o[1];return new i(a,n,e)}).then(function(e){return o.currentComponet=e,e.activeCharEdit()}).catch(function(e){e&&console.error(e),o.currentComponet=null,o.pdfViewer.setActiveElement()})}),this.pdfViewer.getEventEmitter().on(a.default.addTextObjectParamTransfer,this.addTextObjectParamTransferBind=function(e){o.addParams=e})},o.prototype.destroyPageHandler=function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(u),this.addParams=null,this.pdfViewer.getEventEmitter().off(a.default.addTextObjectParamTransfer,this.addTextObjectParamTransferBind),this.resetHandler()},o.prototype.out=function(){this.destroyPageHandler()},o.prototype.resetHandler=function(){this.currentComponet&&(this.currentComponet.textCharSure&&this.currentComponet.textCharSure(),this.currentComponet.unActive())},o}(o.IStateHandler)};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=c(n(2)),a=c(n(4));function c(e){return e&&e.__esModule?e:{default:e}}var u="fv__add-text-object-state-handler"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(3);function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}}(e,t))}var c=o.Deps.jQuery,u=o.IStateHandler,s=o.Events,f=null,l=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n))}return a(t,e),t.setAddon=function(e){f=e},t.getStateName=function(){return"add-image-object"},t.prototype.pageHandler=function(e){var t=this;this.pageRender=e;var n=this.$handler=e.$handler,o=n[0],i=this.hammer=new Hammer.Manager(o,{recognizers:[[Hammer.Tap],[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]}),a=void 0,u=void 0;function l(){return u||(u=c('<img style="position: absolute;top:200%;left:0;border:2px solid transparent;" src="'+a+'"/>'),n.append(u),u)}this.pdfViewer.eventEmitter.on(s.addEditImage,this.loadFile=function(e){a=e}),n.on("mouseenter",function(e){a&&l().show()}),n.on("mousemove mousewheel",function(e){if(a){var t=o.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top;l().css({top:r,left:n})}}),n.on("mouseleave",function(e){a&&l().hide()}),i.on("tap",function(n){if(a){var i={},c=p(o,n),u=l(),s=u.width(),h=u.height();e.getPDFPage().then(function(n){var o=3*s/n.getPxWidth(),l=3*h/n.getPxHeight();if(o>1||l>1){var p=Math.max(o,l);p>1&&(p=1/p),s*=p,h*=p}i.top=c.y,i.left=c.x,i.right=i.left+s,i.bottom=i.top+h,function(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300||304===r.status?t(r.response):n())},r.onerror=function(){n()},r.send()})}(a).then(function(o){var a=n.reverseDeviceRect(i,e.getScale());n.addImage(o,a).then(function(){var o=(a.left+a.right)/2,i=(a.top+a.bottom)/2;n.getGraphicsObjectAtPoint([o,i],3,3).then(function(e){return[f.graphicsManager.get(e),e]}).then(function(t){var n=r(t,2);return new(0,n[0])(n[1],e,f)}).then(function(e){return t.pdfViewer.getStateHandlerManager().switchTo("edit-all"),t.currentComponet=e,u.remove(),e.active()}).catch(function(e){e&&console.error(e),t.currentComponet=null,t.pdfViewer.setActiveElement()})})})})}})},t.prototype.destroyPageHandler=function(){this.$handler.off("mousemove mousewheel mouseleave"),this.$handler.empty(),this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.pdfViewer.eventEmitter.off(s.addEditImage,this.loadFile)},t.prototype.out=function(){this.destroyPageHandler()},t}(u);t.default=l;var p=function(e,t){var n=e.getBoundingClientRect(),r=t.srcEvent,o=(0,i.getClientX)(r),a=(0,i.getClientY)(r);return{x:o-n.left-t.deltaX,y:a-n.top-t.deltaY}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawShape=t.getShapeDom=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)).Deps.jQuery;t.getShapeDom=function(e){var t=e.find(".fv__add-path-preview");return 0==t.length&&(t=r('<canvas class="fv__add-path-preview" style="position: absolute;display:none"></canvas>'),e.append(t)),t},t.drawShape=function(e,t,n){var r=n[0],o=r.getContext("2d");o.clearRect(0,0,n.width(),n.height()),r.width=t.right-t.left+4,r.height=t.bottom-t.top+4,o.clearRect(0,0,n.width(),n.height()),o.lineWidth=2,o.strokeStyle="#5aa",o.transform(1,0,0,1,2-t.left,2-t.top);for(var i=[],a=0;a<e.length;a++)switch(e[a][0]){case"m":o.moveTo(e[a][1],e[a][2]);break;case"l":o.lineTo(e[a][1],e[a][2]);break;case"c":i.push(e[a][1],e[a][2]),6===i.length&&(o.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]),i=[]);break;case"h":4===i.length?(o.bezierCurveTo(i[0],i[1],i[2],i[3],e[a][1],e[a][2]),i=[]):o.lineTo(e[a][1],e[a][2]),o.closePath()}o.stroke(),n.css({left:t.left,top:t.top}).show()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.pointsToRect=function(e,t,n){var r=e.x>t.x?t.x:e.x,o=e.x<t.x?t.x:e.x,i=e.y>t.y?t.y:e.y,a=e.y<t.y?t.y:e.y;if(n){var c=i;(i=a)-(a=c)<1&&(i=a+1,a-=1)}else a-i<1&&(a=i+1,i-=1);return o-r<1&&(o=r+1,r-=1),{left:r-2,top:a+1,right:o+2,bottom:i-1}},e.generatePoints=function(t,n,r){var o=t.x,i=t.y,a=n.x-o,c=n.y-i;switch(r){case"line":return e.genLinePoints(o,i,a,c);case"square":return e.genSquarePoints(o,i,a,c);case"circle":return e.genOvalPoints(o,i,a,c);case"roundRect":return e.genRoundRectPoints(o,i,a,c)}},e.genLinePoints=function(e,t,n,r){var o=[];return o.push(["m",e,t]),o.push(["l",e+n,t+r]),o},e.genOvalPoints=function(e,t,n,r){var i=[];return i.push(["m",e+n/2,t]),(i=(i=(i=(i=i.concat(o(e+n/2,t,n/2,r/2,1))).concat(o(e+n,t+r/2,-n/2,r/2,0))).concat(o(e+n/2,t+r,-n/2,-r/2,1))).concat(o(e,t+r/2,n/2,-r/2,0))).push(["h",i[0][1],i[0][2]]),i},e.genRoundRectPoints=function(e,t,n,r){var i=[],a=.2*n,c=.2*r,u=.8*n,s=.8*r;return i.push(["m",e+a,t]),i.push(["l",e+u,t]),(i=i.concat(o(e+u,t,a,c,1))).push(["l",e+n,t+s]),(i=i.concat(o(e+n,t+s,-a,c,0))).push(["l",e+a,t+r]),(i=i.concat(o(e+a,t+r,-a,-c,1))).push(["l",e,t+c]),(i=i.concat(o(e,t+c,a,-c,0))).push(["l",i[0][1],i[0][2]]),i.push(["h"]),i},e.genSquarePoints=function(e,t,n,r){var o=[];return o.push(["m",e,t]),o.push(["l",e+n,t]),o.push(["l",e+n,t+r]),o.push(["l",e,t+r]),o.push(["h",e,t]),o},e}();function o(e,t,n,r,o){var i=[],a=.5522847498308;return o?(i.push(["c",e+a*n,t]),i.push(["c",e+n,t+a*r]),i.push(["c",e+n,t+r])):(i.push(["c",e,t+a*r]),i.push(["c",e+a*n,t+r]),i.push(["c",e+n,t+r])),i}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=s(n(2)),a=s(n(8)),c=n(7),u=n(3);function s(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}}(e,t))}var l=null,p=0,h=!1,d=[],v=function(e,t,n){e.on(t,n),d.push([e,t,n])},y=function(e){function t(n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n))}return f(t,e),t.setAddon=function(e){l=e},t.getStateName=function(){return"add-path-object"},t.setPathType=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;p=e},t.prototype.pageHandler=function(e){var t=this;this.pageRender=e;var n=e.$handler;n.addClass("fv__create-callout-state-handler "+this.cursorStyle),this.shapeDom=(0,c.getShapeDom)(n);var o=n[0],u=this.hammer=new i.default.Manager(o,{recognizers:[[i.default.Pan,{direction:i.default.DIRECTION_ALL}]]}),s=void 0,f=void 0,d=function(e){h=-1!=e.target.className.indexOf("fv__pdf-page-handler-container")};v(n,"mousedown",d),v(n,"touchstart",d),u.on("panstart",function(e){h&&(s=g(o,e))}).on("panend",function(n){if(s){f={x:s.x+n.deltaX,y:s.y+n.deltaY};var o=t.pageRender.page.reverseDevicePoint([s.x,s.y],t.pageRender.getScale()),i=t.pageRender.page.reverseDevicePoint([f.x,f.y],t.pageRender.getScale()),c={x:o[0],y:o[1]},u={x:i[0],y:i[1]},h=a.default.generatePoints(c,u,p),d=a.default.pointsToRect(c,u);t.pageRender.page.addGraphicsObject({type:2,points:h,rect:d}).then(function(e){return s=null,t.shapeDom.hide(),e}).then(function(e){return e?[l.graphicsManager.get(e),e]:Promise.reject()}).then(function(t){var n=r(t,2);return new(0,n[0])(n[1],e,l)}).then(function(e){return t.currentComponet=e,e.active()}).catch(function(e){e&&console.error(e),t.currentComponet=null,t.pdfViewer.setActiveElement()})}}).on("panmove",function(e){if(s){f={x:s.x+e.deltaX,y:s.y+e.deltaY};var n=a.default.pointsToRect(s,f,!0),r=a.default.generatePoints(s,f,p);(0,c.drawShape)(r,n,t.shapeDom)}})},t.prototype.destroyPageHandler=function(){this.hammer&&this.hammer.destroy(),function(){for(var e=0;e<d.length;e++){var t=d[e];t[0].off(t[1],t[2])}}(),this.resetHandler()},t.prototype.out=function(){this.destroyPageHandler()},t.prototype.resetHandler=function(){this.currentComponet&&this.currentComponet.destroy()},t}(o.IStateHandler);t.default=y;var g=function(e,t){var n=e.getBoundingClientRect(),r=t.srcEvent,o=(0,u.getClientX)(r),i=(0,u.getClientY)(r);return{x:o-n.left-t.deltaX,y:i-n.top-t.deltaY}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.default=function(e){var t=e.graphicsManager,n="text",a=n?["fv__edit-",n,"-state-handler"].join(""):"";return a+=" fv__edit-graphics-state-handler",function(o){function c(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,o.call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}}(e,t))}(c,o),c.getStateName=function(){return"edit-"+n},c.prototype.pageHandler=function(n){var o=this;this.pageRender=n;var c=n.getPDFPage(),u=n.$handler,s=u[0];u.addClass(a);var f=this.hammer=new i.default.Manager(s,{recognizers:[[i.default.Pan,{direction:i.default.DIRECTION_ALL}]]});f.add(new i.default.Tap({event:"doubletap",taps:2})),f.add(new i.default.Tap({event:"singletap"})),f.get("doubletap").recognizeWith("singletap"),f.get("singletap").requireFailure("doubletap"),f.on("singletap",function(i){o.resetHandler();var a=i.changedPointers[0];c.then(function(e){return[e,e.reverseDevicePoint([a.offsetX,a.offsetY],n.getScale())]}).then(function(e){var t=r(e,2),n=t[0],o=r(t[1],2),i=o[0],a=o[1];return n.getGraphicsObjectAtPoint([i,a],3,1)}).then(function(e){return e?[t.get(e),e]:Promise.reject()}).then(function(t){var o=r(t,2);return new(0,o[0])(o[1],n,e)}).then(function(e){return o.currentComponet=e,e.active()}).catch(function(e){e&&console.error(e),o.currentComponet=null,o.pdfViewer.setActiveElement()})}),f.on("doubletap",function(i){o.resetHandler();var a=i.changedPointers[0];c.then(function(e){return[e,e.reverseDevicePoint([a.offsetX,a.offsetY],n.getScale())]}).then(function(e){var t=r(e,2),n=t[0],o=r(t[1],2),i=o[0],a=o[1];return n.getGraphicsObjectAtPoint([i,a],3,1)}).then(function(e){return e?[t.get(e),e]:Promise.reject()}).then(function(t){var o=r(t,2);return new(0,o[0])(o[1],n,e)}).then(function(e){return o.currentComponet=e,e.activeCharEdit()}).catch(function(e){e&&console.error(e),o.currentComponet=null,o.pdfViewer.setActiveElement()})})},c.prototype.destroyPageHandler=function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(a),this.resetHandler()},c.prototype.out=function(){this.destroyPageHandler()},c.prototype.resetHandler=function(){this.currentComponet&&(this.currentComponet.textCharSure&&this.currentComponet.textCharSure(),this.currentComponet.unActive())},c}(o.IStateHandler)};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=function(e){return e&&e.__esModule?e:{default:e}}(n(2))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.default=function(e,t){var n=e.graphicsManager,a=["","text","path","image","shading","all"][t],u=a?["fv__edit-",a,"-state-handler"].join(""):"";return u+=" fv__edit-graphics-state-handler",function(o){function s(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,o.call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}}(e,t))}(s,o),s.getStateName=function(){return"edit-"+a},s.prototype.pageHandler=function(o){var a=this;this.pageRender=o;var s=o.getPDFPage(),f=o.$handler,l=f[0];f.addClass(u),(this.hammer=new i.default(l)).on("tap",function(i){if(-1!=i.target.className.indexOf("fv__shape-control-move-area"))return Promise.resolve();a.resetHandler();var u=c(l,i);s.then(function(e){return[e,e.reverseDevicePoint([u.x,u.y],o.getScale())]}).then(function(e){var n=r(e,2),o=n[0],i=r(n[1],2),a=i[0],c=i[1];return 5===t?o.getGraphicsObjectAtPoint([a,c],5,0):o.getGraphicsObjectAtPoint([a,c],3,t)}).then(function(e){return!e||e.type<1||e.type>3?Promise.reject():[n.get(e),e]}).then(function(t){var n=r(t,2);return new(0,n[0])(n[1],o,e)}).then(function(e){return a.currentComponet=e,e.active()}).catch(function(e){e&&console.error(e),a.currentComponet=null,a.pdfViewer.setActiveElement()})})},s.prototype.destroyPageHandler=function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(u),this.resetHandler()},s.prototype.out=function(){this.destroyPageHandler()},s.prototype.resetHandler=function(){this.currentComponet&&(this.currentComponet.textCharSure&&this.currentComponet.textCharSure(),this.currentComponet.unActive())},s}(o.IStateHandler)};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=function(e){return e&&e.__esModule?e:{default:e}}(n(2)),a=n(3);var c=function(e,t){var n=e.getBoundingClientRect(),r=t.srcEvent,o=(0,a.getClientX)(r),i=(0,a.getClientY)(r);return{x:o-n.left-t.deltaX,y:i-n.top-t.deltaY}}},function(e,t,n){"use strict";function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}}(e,t))}Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(n,r,o){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n,r,o))}return r(t,e),t.prototype.active=function(){},t.prototype.getContextMenuConfig=function(){},t}(function(e){return e&&e.__esModule?e:{default:e}}(n(1)).default);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DIR_NORTH="north",t.DIR_SOUTH="south",t.DIR_EAST="east",t.DIR_WEST="west",t.DIR_NORTH_WEST="north-west",t.DIR_NORTH_EAST="north-east",t.DIR_SOUTH_WEST="south-west",t.DIR_SOUTH_EAST="south-east"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(13);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}}(e,t))}var s=o.Deps.jQuery,f=o.Events,l=function(e){function t(){return a(this,t),c(this,e.apply(this,arguments))}return u(t,e),t.prototype._resize=function(t,n,r){t==i.DIR_NORTH||t==i.DIR_SOUTH||t==i.DIR_EAST||t==i.DIR_WEST?this.enableUniform=!1:this.enableUniform=!0,e.prototype._resize.call(this,t,n,r)},t}(o.ShapeControl),p=function(e){function t(n,r,o){return a(this,t),c(this,e.call(this,n,r,o))}return u(t,e),t.getDefaultContextMenuConfig=function(){return defaultContextMenuConfig},t.setContextMenuConfig=function(e){e},t.prototype.initUI=function(){var e=this,t=this,n=this.$handler=s('<div class="fwr__graphics-object-handler" \n        ></div>');return this.pageRender.pageHandler.$handler.append(n),this.shapeControl=new l({start:function(t,n,r){return e.onStartUpdateShape(t,n,r)},moving:function(t,n,r){var o=r.offsetX,i=r.offsetY;return e.onShapeMoving(t,n,o,i)},update:function(t,n){return e.onShapeUpdating(t,n)},rotate:function(t,n){return e.onRotate(t,n)},end:function(t,n,r){return e.onShapeUpdateEnd(t,n,r)},resizable:!0,rotatable:!0,enableDiagonally:!0,enableFrame:!0,enableUniform:!0,previewer:!0,enableSizeBox:!0}),this.dependences.pdfViewer.eventEmitter.on(f.zoomToSuccess,this.afterZoom=function(){t.updateShapeControl()}),this.$handler},t.prototype.onRotate=function(e){var t=this;return this.graphicsObject.setRotation(e).then(function(e){t.updateShapeControl()})},t.prototype.getContextMenuConfig=function(){var e=this;return{selector:"div.fv__shape-control",items:{properties:{name:"properties",nameI18nKey:"viewer_:contextmenu.annot.properties",callback:function(t,n,r){e.showPropertiesDialog(r)}},remove:{name:"delete",nameI18nKey:"viewer_:contextmenu.annot.delete",callback:function(){e.remove()}}}}},t.prototype.getPropertyOptions=function(){return{opacity:this.graphicsObject.getOpacity(),borderStyle:!1}},t.prototype.showPropertiesDialog=function(e){var t=this.dependences.pdfViewer.activePropertiesDialog;this.dependences.pdfViewer.activePropertiesDialog?(t.show(e),t.setViewerComponent(this)):this.$propertiesControl=new o.PropertiesControl(this)},t.prototype.hidePropertiesDialog=function(){this.$propertiesControl.close()},t.prototype.destroy=function(){this.$handler.contextMenu("destroy"),this.dependences.pdfViewer.eventEmitter.off(f.zoomToSuccess,this.afterZoom)},t.prototype.setOpacity=function(e){this.graphicsObject.setOpacity(e)},t.prototype.remove=function(){this.$handler.contextMenu("hide"),this.graphicsObject.remove(),this.dependences.pdfViewer.setActiveElement(null),this.destroy()},t}(r.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(3);function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}}(e,t))}var c=o.Deps.jQuery,u=function(e){function t(n,r,o){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n,r,o))}return a(t,e),t.prototype.active=function(){e.prototype.active.call(this)},t.prototype.getPropertyOptions=function(){var e=this.graphicsObject,t=e.getBorderColor();t=this.graphicsObject.needStroke()?"#"+(t=(4278190080|t).toString(16)).substr(2,6):0;var n=e.getFillColor();0==e.getFillMode()&&(n=0);var r=e.getBorderWidth();return{color:t,borderTransparent:!0,opacity:e.getOpacity(),fillColor:n,borderWidth:r}},t.prototype.initUI=function(){var t=this;e.prototype.initUI.call(this),this.$tip=c('<div class="fwr__path-object-tip"></div>'),this.$tip.appendTo(this.$handler);var n=this.rectHammer=new Hammer.Manager(this.$handler[0],{recognizers:[[Hammer.Press]]});return this.$handler.on("mousemove",function(e){t.$tip.hide()}),n.on("press",function(e){if(!c(".fv__ui-mobile").length){var n=t.graphicsObject.getRect(),r=s(t.$handler.parent()[0],e),o={left:r.x+"px",top:r.y+20+"px"};r=t.pageRender.page.reverseDevicePoint([r.x,r.y],t.pageRender.getScale()),t.$tip.show().css(o).html("object : x:"+n.left.toFixed(2)+",y:"+n.bottom.toFixed(2)+"<br/>mouse: x:"+r[0].toFixed(2)+",y:"+r[1].toFixed(2))}}),this.$handler},t.prototype.getContextMenuConfig=function(){var e=this;return{selector:"div.fv__shape-control",items:{properties:{name:"properties",nameI18nKey:"viewer_:contextmenu.annot.properties",callback:function(t,n,r){var i=e.dependences.pdfViewer.activePropertiesDialog;e.dependences.pdfViewer.activePropertiesDialog?(i.show(r),i.setViewerComponent(e)):e.propertiesControl=new o.PropertiesControl(e)}},remove:{name:"delete",nameI18nKey:"viewer_:contextmenu.annot.delete",callback:function(){return e.removeGraphicObject()}}}}},t.prototype.removeGraphicObject=function(){this.$handler.contextMenu("hide"),this.graphicsObject.remove(),this.dependences.pdfViewer.setActiveElement(null),this.destroy()},t.prototype.remove=function(){this.removeGraphicObject()},t.prototype.destroy=function(){this.$handler&&(this.$handler.contextMenu("destroy"),this.propertiesControl&&this.propertiesControl.close(),this.propertiesControl=null,this.rectHammer.destroy(),e.prototype.destroy.call(this))},t}(r.default);t.default=u;var s=function(e,t){var n=e.getBoundingClientRect(),r=t.srcEvent,o=(0,i.getClientX)(r),a=(0,i.getClientY)(r);return{x:o-n.left-t.deltaX,y:a-n.top-t.deltaY}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=void 0,o=void 0,i={};"function"==typeof FontFace?(t.addFont=r=function(e,t){return i[e]?i[e]:i[e]=new Promise(function(n,r){t().then(function(t){if(!t)return r(),void i[e];var o=new FontFace(e,t.buffer||t.url);o.load().then(function(){document.fonts.add(o),n(o)})},function(){r(),delete i[e]})})},t.removeFont=o=function(e){i[e]&&i[e].then(function(t){delete i[e],document.fonts.delete(t)})}):(t.addFont=r=function(e,t){return i[e]?i[e]:i[e]=new Promise(function(n,r){t().then(function(t){if(!t)throw r(),delete i[e],"woff is invalid";return t.buffer?URL.createObjectURL(new Blob([t.buffer],"application/x-font-woff")):t.url}).then(function(t){var r=document.createElement("style");r.innerHTML='@font-face{font-family:"'+e+'"; src:url("'+t+'");}',document.head.appendChild(r),n(r)})})},t.removeFont=o=function(e){i[e]&&i[e].then(function(t){delete i[e],t.parentNode.removeChild(t)})}),t.addFont=r,t.removeFont=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=u(n(1)),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),a=u(n(4)),c=n(16);function u(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}}(e,t))}var f=i.Deps.jQuery,l=i.shared.browser.ptPxRatio,p=function(e){function t(n,r,o){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n,r,o))}return s(t,e),t.prototype.initUI=function(){var t=this,n=this.$handler=f('<div class="fwr__graphics-object-handler fwr__text-object-edit"\n        ></div>');this.pageRender.pageHandler.$handler.after(n);this.shapeControl=new i.ShapeControl({start:function(e,n,r){return t.onStartUpdateShape(e,n,r)},moving:function(e,n,r){var o=r.offsetX,i=r.offsetY;return t.onShapeMoving(e,n,o,i)},update:function(e,n){return t.onShapeUpdating(e,n)},rotate:function(e,n){return t.onRotate(e,n)},end:function(e,n,r){return t.onShapeUpdateEnd(e,n,r)},resizable:!0,enableDiagonally:!0,enableFrame:!0,previewer:!0});return n.on("dblclick",function(){e.prototype.unActive.call(t),t.activeCharEdit()}),this.$handler},t.prototype.reActive=function(){},t.prototype.active=function(){e.prototype.active.call(this),this.reActive=this.active,this.pageRender.pdfViewer.getEventEmitter().emit(a.default.textObjectActive,this)},t.prototype.unActive=function(){e.prototype.unActive.call(this),this.unActiveCharEdit(),this.reActive=function(){},this.pageRender.pdfViewer.getEventEmitter().emit(a.default.textObjectUnActive,this)},t.prototype.unActiveCharEdit=function(){this.$charEditContainer&&this.$charEditContainer.remove(),this.$charEditContainer=null},t.prototype.initCharEditContainer=function(){var e=f('<div class="fv__text-object-edit-char-container"><div class="fv__text-object-edit-char-mask-layer"></div><span class="fv__text-object-edit-char-input" contenteditable></span></div>');return this.pageRender.$handler.after(e),e},t.prototype.activeCharEdit=function(){var e=this,t=this.$charEditContainer=this.$charEditContainer||this.initCharEditContainer(),n=t.find(".fv__text-object-edit-char-mask-layer"),o=t.find(".fv__text-object-edit-char-input"),i=o[0];o.on("keydown",function(t){if(13===t.keyCode){t.preventDefault();var n=i.textContent;"string"!=typeof n&&(n=i.innerText),e.setTextChar(n).then(function(){e.unActive()})}});var u=this.graphicsObject,s=u.getRect(),f=this.pageRender;return Promise.all([f.getPDFPage(),f.getScale()]).then(function(e){var t=r(e,2),n=t[0],o=t[1];return[n.getDeviceRect(s,o),n,o]}).then(function(s){var f=r(s,3),p=f[0],h=(f[1],f[2]);t.css({left:p.left+"px",top:p.bottom+"px"}),i.focus(),n.css({width:p.right-p.left+"px",height:p.bottom-p.top+"px"}),"string"==typeof i.textContent?i.textContent=u.info.textState.text:i.innerText=u.info.textState.text;var d=u.info.textState.size,v=[].concat(u.info.textState.matrix);d*l<12&&(d*=12,v[0]/=12,v[1]/=12,v[2]/=12,v[3]/=12),v[0]*=h,v[1]*=-h,v[2]*=-h,v[3]*=h,o.css({fontFamily:'"'+[u.info.textState.font.baseName,u.info.textState.font.familyName,u.info.textState.font.nameKey,u.info.textState.font.name,"FoxitPDFSDKForWeb"].join('","')+'"',fontSize:d+"pt",fontWeight:u.info.textState.font.isBold?700:400,fontStyle:u.info.textState.font.isItalic?"italic":"",transform:"matrix("+v.join(",")+",0,0)",color:function(e){if(e<0)return"#000000";var t=e.toString(16),n=6;e>16777215&&(n=8);for(;t.length<n;)t="0"+t;return"#"+t}(16777215&u.getFillColor())}),(0,c.addFont)(u.info.textState.font.nameKey||u.info.textState.font.name,u.getWoff.bind(u)),e.reActive=e.activeCharEdit,e.pageRender.pdfViewer.getEventEmitter().emit(a.default.textObjectActive,e)})},t.prototype.setTextChar=function(e){return this.graphicsObject.setText(e)},t.prototype.getContextMenuConfig=function(){},t.prototype.getTextChar=function(){if(this.$charEditContainer){var e=this.$charEditContainer.find(".fv__text-object-edit-char-input")[0],t=e.textContent;return"string"!=typeof t&&(t=e.innerText),t}return this.getModel().getText()},t.prototype.textCharSure=function(){if(this.$charEditContainer){var e=this.$charEditContainer.find(".fv__text-object-edit-char-input")[0],t=e.textContent;return"string"!=typeof t&&(t=e.innerText),this.getModel().setText(t)}return Promise.resolve()},t.prototype.remove=function(){this.$handler.contextMenu("hide"),this.graphicsObject.remove(),this.dependences.pdfViewer.setActiveElement(null),this.destroy()},t}(o.default);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.KEY_MAP_SELECT_ALL_ANNOTATIONS="selectAllAnnotations",t.KEY_MAP_POLYLINE_DELETE_LAST_POINT="createPolyline_DeleteLastPoint",t.KEY_MAP_DOCUMENT_UNDO="undo",t.KEY_MAP_DOCUMENT_REDO="redo",t.KEY_MAP_ZOOM_IN="pageZoomIn",t.KEY_MAP_ZOOM_OUT="pageZoomOut",t.KEY_MAP_DELETE_ANNOTATION="delete-annotation",t.KEY_MAP_ESC_CREATING_DRAWING="cancel-creating-drawing-annot",t.VIEWER_BINDER="pdf-viewer-keyboard-event-binder",t.ANNOTATION_PROPERTIES_BINDER="annotation-properties-keyboard-event-binder",t.DOCUMENT_PROPERTIES_BINDER="document-properties-keyboard-event-binder",t.FOCUS_ELEMENT_BINDER="focus-element-keyboard-event-binder",t.ANNOTATION_CREATING_BINDER="create-annotation-keyboard-event-binder"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(1)),o=c(n(17)),i=c(n(15)),a=c(n(14));c(n(12));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.matchRules=[]}return e.prototype.registerMatchRule=function(e){return this.matchRules.push(e),e},e.prototype.unRegisterMatchRule=function(e){var t=this.matchRules.indexOf(e);-1!==t&&this.matchRules.splice(t,1)},e.prototype.get=function(e){for(var t=this.matchRules,n=this.getDefault(e),r=t.length;r--;){var o=t[r];if("function"==typeof o){var i=o(e,n);if(i)return i}}return n},e.prototype.getDefault=function(e){switch(e.getType()){case 1:return o.default;case 2:return i.default;case 3:return a.default;default:return r.default}},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);t.default=e}(n(0));var r=s(n(19)),o=s(n(11)),i=s(n(10));n(28);var a=s(n(9)),c=s(n(6)),u=s(n(5));function s(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pdfViewer=t,this.graphicsManager=new r.default}return e.prototype.init=function(){var e=(0,i.default)(this),t=(0,o.default)(this,2),n=(0,o.default)(this,3),r=(0,o.default)(this,5);a.default.setAddon(this),c.default.setAddon(this);var s=(0,u.default)(this),f=this.pdfViewer.getStateHandlerManager();f.register(e),f.register(t),f.register(n),f.register(r),f.register(a.default),f.register(s),f.register(c.default)},e.prototype.getGraphicsManager=function(){return this.graphicsManager},e}();t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditGraphicsAddonEvents=t.EditGraphicsAddon=void 0;var r=i(n(20)),o=i(n(4));function i(e){return e&&e.__esModule?e:{default:e}}t.EditGraphicsAddon=r.default,t.EditGraphicsAddonEvents=o.default},,,,,,,function(e,t){}])});